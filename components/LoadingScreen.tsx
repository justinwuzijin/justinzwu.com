'use client'

import React, { useState, useEffect } from 'react'
import { motion, AnimatePresence } from 'framer-motion'
import { useTheme } from '@/components/ThemeProvider'
import styles from './LoadingScreen.module.css'

// Paths from LOADER3(B).svg - Offset the Y coordinates to prevent clipping
const justinPaths = [
  "M0 237.065C2.6343 242.025 4.817 244.671 6.84917 244.671C10.6124 244.671 13.322 239.049 13.322 221.852V61.122H35.7512V224.828C35.7512 290.641 23.0313 299.24 15.1284 299.24C8.20395 299.24 3.46222 290.641 0 284.688V237.065Z",
  "M96.2533 61.122V224.167C96.2533 294.941 85.074 299.24 68.7524 299.24C52.4307 299.24 41.2515 294.941 41.2515 224.167V61.122H63.4609V227.474C63.4609 241.364 65.9203 245.002 68.7524 245.002C71.5844 245.002 74.0439 241.364 74.0439 227.474V61.122H96.2533Z",
  "M123.971 219.008V229.319C123.971 241.241 124.954 248.33 129.866 248.33C133.947 248.33 135.534 242.208 135.534 231.897V229.963C135.534 215.786 133.342 214.819 118.303 200.642C105.683 188.72 102.735 175.831 102.735 134.587V129.11C102.735 71.755 114.373 61.122 130.395 61.122C150.875 61.122 156.694 76.588 156.694 118.154V136.521H135.912V127.821C135.912 110.743 134.325 106.554 130.546 106.554C126.692 106.554 124.878 109.777 124.878 121.054V123.954C124.878 138.776 127.599 141.998 138.179 151.665C148.381 161.009 158.13 168.098 158.13 219.33V225.13C158.13 278.296 149.515 299.24 128.959 299.24C111.88 299.24 101.753 285.385 101.753 242.852V219.008H123.971Z",
  "M208.549 61.122V111.651H195.177V298.504H172.663V111.651H159.215V61.122H208.549Z",
  "M212.361 61.122H234.875V298.504H212.361V61.122Z",
  "M287.178 61.122H307.426V298.504H275.695L260.131 145.562H259.98V298.504H239.733V61.122H271.237L287.103 210.673H287.178V61.122Z"
]

const zijinPaths = [
  "M310.908 298.494V260.972L344.156 111.766V110.662H311.752V61.442H370.485V102.937L338.249 248.17V249.494H371.751V298.494H310.908Z",
  "M382.215 298.494V61.442H406.265V298.494H382.215Z",
  "M416.668 299.24C415.383 299.24 414.07 299.184 412.73 299.074C411.333 298.963 410.16 298.742 409.21 298.41V261.886C409.657 261.997 410.104 262.052 410.551 262.052C410.998 262.163 411.473 262.218 411.976 262.218C415.327 262.218 417.59 260.614 418.763 257.404C419.992 254.305 420.606 249.989 420.606 244.455V62.004H444.487V243.791C444.487 262.827 442.057 276.828 437.197 285.793C432.393 294.757 425.55 299.24 416.668 299.24Z",
  "M455.07 298.358V62.004H467.417H479.764V298.358H455.07Z",
  "M492.085 298.494V61.442H516.136V96.095H516.557C518.301 83.882 520.861 74.391 524.237 67.622C527.668 60.706 531.972 57.248 537.148 57.248C544.349 57.248 549.974 63.943 554.025 77.334C558.132 90.577 560.185 108.749 560.185 131.851V298.494H536.051V144.653C536.051 134.5 535.291 126.48 533.772 120.595C532.253 114.562 529.806 111.545 526.431 111.545C524.237 111.545 522.352 113.017 520.777 115.959C519.258 118.755 518.105 122.875 517.317 128.32C516.529 133.617 516.136 139.797 516.136 146.86V298.494H492.085Z"
]

const wuPaths = [
  "M633.304 61.49H657.48L648.565 298.872H617.061L609.959 155.425H609.657L602.555 298.872H570.975L562.061 61.49H586.236L589.183 217.484H589.636L597.267 61.49H622.349L629.904 217.484H630.358L633.304 61.49Z",
  "M717 61.122V224.167C717 294.941 705.541 299.24 688.811 299.24C672.082 299.24 660.623 294.941 660.623 224.167V61.122H683.388V227.474C683.388 241.364 685.909 245.002 688.811 245.002C691.714 245.002 694.235 241.364 694.235 227.474V61.122H96.2533Z"
]

const detailPaths = [
  "M393.503 51.4327C393.802 50.5114 395.105 50.5114 395.405 51.4327L398.44 60.7749C398.574 61.1869 398.958 61.4659 399.391 61.4659H409.214C410.183 61.4659 410.586 62.7055 409.802 63.2749L401.855 69.0487C401.504 69.3034 401.358 69.7548 401.492 70.1668L404.527 79.509C404.827 80.4303 403.772 81.1965 402.988 80.6271L395.041 74.8532C394.691 74.5986 394.216 74.5986 393.866 74.8532L385.919 80.6271C385.135 81.1965 384.081 80.4303 384.38 79.509L387.415 70.1668C387.549 69.7548 387.403 69.3034 387.052 69.0487L379.105 63.2749C378.321 62.7055 378.724 61.4659 379.693 61.4659H389.516C389.949 61.4659 390.333 61.1869 390.467 60.7749L393.503 51.4327Z",
  "M466.715 51.0401C467.037 50.1695 468.268 50.1695 468.591 51.0401L472.559 61.7648C472.66 62.0385 472.876 62.2543 473.15 62.3556L483.875 66.3241C484.745 66.6462 484.745 67.8776 483.875 68.1998L473.15 72.1682C472.876 72.2695 472.66 72.4853 472.559 72.7591L468.591 83.4837C468.268 84.3543 467.037 84.3543 466.715 83.4837L462.746 72.7591C462.645 72.4853 462.429 72.2695 462.156 72.1682L451.431 68.1998C450.56 67.8776 450.56 66.6462 451.431 66.3241L462.156 62.3556C462.429 62.2543 462.645 62.0385 462.746 61.7648L466.715 51.0401Z",
  "M425.755 66.6711C425.411 66.3265 425.411 65.7681 425.755 65.4238L431.103 52.6569C431.447 52.3126 432.005 52.3124 432.35 52.6569L437.432 65.4804C437.776 65.8249 437.776 66.3833 437.432 66.7276L432.35 79.0516C432.006 79.3959 431.447 79.3961 431.103 79.0516L425.755 66.6711Z"
]

// Paths from LOADER3(B).svg - Offset the Y coordinates to prevent clipping
const justinPaths = [
  "M0 237.065C2.6343 242.025 4.817 244.671 6.84917 244.671C10.6124 244.671 13.322 239.049 13.322 221.852V61.122H35.7512V224.828C35.7512 290.641 23.0313 299.24 15.1284 299.24C8.20395 299.24 3.46222 290.641 0 284.688V237.065Z",
  "M96.2533 61.122V224.167C96.2533 294.941 85.074 299.24 68.7524 299.24C52.4307 299.24 41.2515 294.941 41.2515 224.167V61.122H63.4609V227.474C63.4609 241.364 65.9203 245.002 68.7524 245.002C71.5844 245.002 74.0439 241.364 74.0439 227.474V61.122H96.2533Z",
  "M123.971 219.008V229.319C123.971 241.241 124.954 248.33 129.866 248.33C133.947 248.33 135.534 242.208 135.534 231.897V229.963C135.534 215.786 133.342 214.819 118.303 200.642C105.683 188.72 102.735 175.831 102.735 134.587V129.11C102.735 71.755 114.373 61.122 130.395 61.122C150.875 61.122 156.694 76.588 156.694 118.154V136.521H135.912V127.821C135.912 110.743 134.325 106.554 130.546 106.554C126.692 106.554 124.878 109.777 124.878 121.054V123.954C124.878 138.776 127.599 141.998 138.179 151.665C148.381 161.009 158.13 168.098 158.13 219.33V225.13C158.13 278.296 149.515 299.24 128.959 299.24C111.88 299.24 101.753 285.385 101.753 242.852V219.008H123.971Z",
  "M208.549 61.122V111.651H195.177V298.504H172.663V111.651H159.215V61.122H208.549Z",
  "M212.361 61.122H234.875V298.504H212.361V61.122Z",
  "M287.178 61.122H307.426V298.504H275.695L260.131 145.562H259.98V298.504H239.733V61.122H271.237L287.103 210.673H287.178V61.122Z"
]

const zijinPaths = [
  "M310.908 298.494V260.972L344.156 111.766V110.662H311.752V61.442H370.485V102.937L338.249 248.17V249.494H371.751V298.494H310.908Z",
  "M382.215 298.494V61.442H406.265V298.494H382.215Z",
  "M416.668 299.24C415.383 299.24 414.07 299.184 412.73 299.074C411.333 298.963 410.16 298.742 409.21 298.41V261.886C409.657 261.997 410.104 262.052 410.551 262.052C410.998 262.163 411.473 262.218 411.976 262.218C415.327 262.218 417.59 260.614 418.763 257.404C419.992 254.305 420.606 249.989 420.606 244.455V62.004H444.487V243.791C444.487 262.827 442.057 276.828 437.197 285.793C432.393 294.757 425.55 299.24 416.668 299.24Z",
  "M455.07 298.358V62.004H467.417H479.764V298.358H455.07Z",
  "M492.085 298.494V61.442H516.136V96.095H516.557C518.301 83.882 520.861 74.391 524.237 67.622C527.668 60.706 531.972 57.248 537.148 57.248C544.349 57.248 549.974 63.943 554.025 77.334C558.132 90.577 560.185 108.749 560.185 131.851V298.494H536.051V144.653C536.051 134.5 535.291 126.48 533.772 120.595C532.253 114.562 529.806 111.545 526.431 111.545C524.237 111.545 522.352 113.017 520.777 115.959C519.258 118.755 518.105 122.875 517.317 128.32C516.529 133.617 516.136 139.797 516.136 146.86V298.494H492.085Z"
]

const wuPaths = [
  "M633.304 61.49H657.48L648.565 298.872H617.061L609.959 155.425H609.657L602.555 298.872H570.975L562.061 61.49H586.236L589.183 217.484H589.636L597.267 61.49H622.349L629.904 217.484H630.358L633.304 61.49Z",
  "M717 61.122V224.167C717 294.941 705.541 299.24 688.811 299.24C672.082 299.24 660.623 294.941 660.623 224.167V61.122H683.388V227.474C683.388 241.364 685.909 245.002 688.811 245.002C691.714 245.002 694.235 241.364 694.235 227.474V61.122H717Z"
]

const detailPaths = [
  "M393.503 51.4327C393.802 50.5114 395.105 50.5114 395.405 51.4327L398.44 60.7749C398.574 61.1869 398.958 61.4659 399.391 61.4659H409.214C410.183 61.4659 410.586 62.7055 409.802 63.2749L401.855 69.0487C401.504 69.3034 401.358 69.7548 401.492 70.1668L404.527 79.509C404.827 80.4303 403.772 81.1965 402.988 80.6271L395.041 74.8532C394.691 74.5986 394.216 74.5986 393.866 74.8532L385.919 80.6271C385.135 81.1965 384.081 80.4303 384.38 79.509L387.415 70.1668C387.549 69.7548 387.403 69.3034 387.052 69.0487L379.105 63.2749C378.321 62.7055 378.724 61.4659 379.693 61.4659H389.516C389.949 61.4659 390.333 61.1869 390.467 60.7749L393.503 51.4327Z",
  "M466.715 51.0401C467.037 50.1695 468.268 50.1695 468.591 51.0401L472.559 61.7648C472.66 62.0385 472.876 62.2543 473.15 62.3556L483.875 66.3241C484.745 66.6462 484.745 67.8776 483.875 68.1998L473.15 72.1682C472.876 72.2695 472.66 72.4853 472.559 72.7591L468.591 83.4837C468.268 84.3543 467.037 84.3543 466.715 83.4837L462.746 72.7591C462.645 72.4853 462.429 72.2695 462.156 72.1682L451.431 68.1998C450.56 67.8776 450.56 66.6462 451.431 66.3241L462.156 62.3556C462.429 62.2543 462.645 62.0385 462.746 61.7648L466.715 51.0401Z",
  "M425.755 66.6711C425.411 66.3265 425.411 65.7681 425.755 65.4238L431.103 52.6569C431.447 52.3126 432.005 52.3124 432.35 52.6569L437.432 65.4804C437.776 65.8249 437.776 66.3833 437.432 66.7276L432.35 79.0516C432.006 79.3959 431.447 79.3961 431.103 79.0516L425.755 66.6711Z"
]

export function LoadingScreen() {
  const { theme } = useTheme()
  const [stage, setStage] = useState<'reveal' | 'ball'>('reveal')
  const [isVisible, setIsVisible] = useState(true)

  useEffect(() => {
    // Stage 1: Name is already revealed ("JUSTIN ZIJIN WU")
    
    // Stage 2: Reveal ball after 1.2s
    const timer2 = setTimeout(() => {
      setStage('ball')
    }, 1200)

    // Stage 3: Fade out after 4s total
    const timer3 = setTimeout(() => {
      setIsVisible(false)
    }, 4000)

    return () => {
      clearTimeout(timer2)
      clearTimeout(timer3)
    }
  }, [])

  if (!isVisible) return null

  const isOrange = theme === 'orange'
  const isDark = theme === 'dark'
  
  // Model-specific color logic
  const mainColor = isOrange || isDark ? 'white' : 'black'
  const middleNameColor = isOrange ? 'black' : mainColor
  const ballColor = isOrange ? 'white' : '#CB5500'
  const ballDetailColor = isOrange ? '#CB5500' : mainColor

  return (
    <AnimatePresence>
      {isVisible && (
        <motion.div 
          className={styles.loadingScreen}
          initial={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          transition={{ duration: 0.5 }}
        >
          <div className={styles.loaderContainer}>
            <div className={styles.svgWrapper}>
              <motion.svg 
                width="717" 
                height="400" 
                viewBox="0 0 717 400" 
                fill="none" 
                xmlns="http://www.w3.org/2000/svg"
                className={styles.loaderSvg}
              >
                {/* JUSTIN */}
                <motion.g initial={{ x: 0 }}>
                  {justinPaths.map((path, i) => (
                    <path key={`justin-${i}`} d={path} fill={mainColor} />
                  ))}
                </motion.g>

                {/* ZIJIN */}
                <motion.g initial={{ opacity: 1 }}>
                  {zijinPaths.map((path, i) => (
                    <path key={`zijin-${i}`} d={path} fill={middleNameColor} />
                  ))}
                </motion.g>

                {/* WU */}
                <motion.g initial={{ x: 0 }}>
                  {wuPaths.map((path, i) => (
                    <path key={`wu-${i}`} d={path} fill={mainColor} />
                  ))}
                </motion.g>

                {/* PING PONG BALL */}
                <AnimatePresence>
                  {stage === 'ball' && (
                    <motion.g
                      initial={{ opacity: 0, y: -80 }}
                      animate={{ opacity: 1, y: 0 }}
                      exit={{ opacity: 0 }}
                      transition={{ duration: 0.5 }}
                    >
                      <motion.circle
                        cx="431.699"
                        cy="66.5849"
                        r="66.5849"
                        fill={ballColor}
                        animate={{
                          y: [0, -40, 0],
                        }}
                        transition={{
                          duration: 0.8,
                          repeat: Infinity,
                          ease: [0.17, 0.67, 0.83, 0.67] // Realistic ping pong bounce
                        }}
                      />
                      {detailPaths.map((path, i) => (
                        <motion.path 
                          key={`detail-${i}`} 
                          d={path} 
                          fill={ballDetailColor}
                          animate={{
                            y: [0, -40, 0],
                          }}
                          transition={{
                            duration: 0.8,
                            repeat: Infinity,
                            ease: [0.17, 0.67, 0.83, 0.67]
                          }}
                        />
                      ))}
                    </motion.g>
                  )}
                </AnimatePresence>
              </motion.svg>
            </div>

            {/* Side-to-side bouncing ball */}
            <div className={styles.sideBallContainer}>
              <motion.div
                className={styles.sideBall}
                style={{ backgroundColor: ballColor }}
                animate={{
                  x: [-250, 250, -250],
                  y: [0, -40, 0, -40, 0],
                }}
                transition={{
                  x: { duration: 4, repeat: Infinity, ease: "easeInOut" },
                  y: { duration: 1, repeat: Infinity, ease: "easeOut" }
                }}
              />
            </div>
          </div>
        </motion.div>
      )}
    </AnimatePresence>
  )
}

